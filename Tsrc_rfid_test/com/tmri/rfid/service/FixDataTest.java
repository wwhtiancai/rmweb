package com.tmri.rfid.service;

import com.tmri.framework.service.SysuserManager;
import com.tmri.framework.web.support.UserState;
import com.tmri.rfid.bean.CustomizeTask;
import com.tmri.rfid.bean.EriCustomizeContent;
import com.tmri.rfid.bean.Vehicle;
import com.tmri.rfid.common.CustomizeTaskType;
import com.tmri.rfid.util.MapUtilities;
import com.tmri.share.frm.bean.SysUser;
import com.tmri.share.frm.util.FuncUtil;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import javax.annotation.Resource;
import java.util.Map;

/**
 * Created by Joey on 2017/4/6.
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations={"classpath:spring-config.xml"})
public class FixDataTest {

    public static final Logger LOG = LoggerFactory.getLogger(FixDataTest.class);

    @Resource
    private RemoteVehicleService remoteVehicleService;

    @Resource
    private EriService eriService;

    @Resource
    private CustomizeTaskService customizeTaskService;

    @Resource
    private SysuserManager sysuserManager;

    @Resource
    private VehicleService vehicleService;

    @Test
    public void fix() {
        String cert = "";
        String[] dataList = {
                "À’B880VZ|02|320000608209",
                "À’B0V892|02|320000608207",
                "À’BL981A|02|320000608208",
                "À’CLZ510|02|320000608206",
                "À’B992P6|02|320000608205",
                "À’B238Q1|02|320000608204",
                "À’B360Q8|02|320000608203",
                "À’B663BK|02|320000608202",
                "À’BQ7G73|02|320000608201",
                "À’BA986Q|02|320000608200",
                "À’B908VQ|02|320000608219",
                "À’B7JM26|02|320000600397",
                "À’BK029D|02|320000608218",
                "À’B4A444|02|320000600688",
                "À’B227VH|02|320000608217",
                "À’BV835Y|02|320000608216",
                "À’BKC372|02|320000608215",
                "À’BL5N21|02|320000608213",
                "À’BA205Z|02|320000608214",
                "À’BQ0K15|02|320000608211",
                "À’BVU228|02|320000608212",
                "À’B018A0|02|320000608210",
                "À’BR989Q|02|320000608229",
                "À’B958YW|02|320000608228",
                "À’BB6578|01|320000600399",
                "À’B8MY97|02|320000300698",
                "À’BT6G60|02|320000603500",
                "À’B50M82|02|320000608227",
                "À’BKK291|02|320000608226",
                "À’B569AJ|02|320000608092",
                "À’B3LV59|02|320000608093",
                "À’B2MJ98|02|320000608091",
                "À’BV7N20|02|320000608225",
                "À’BNC399|02|320000608224",
                "À’B571VJ|02|320000608223",
                "À’B362S9|02|320000608222",
                "À’BV7829|02|320000608221",
                "À’B958VH|02|320000608239",
                "À’BY5U55|02|320000608220",
                "À’B695S5|02|320000608238",
                "À’BYS900|02|320000608237",
                "À’BV3K59|02|320000608236",
                "À’B85262|02|320000608094",
                "À’B8269R|02|320000608235",
                "À’B781Q3|02|320000608234",
                "À’BB8267|02|320000608233",
                "À’BN271Z|02|320000608232",
                "À’B6JJ76|02|320000608231",
                "À’B59M17|02|320000608230",
                "À’BQ966D|02|320000608260",
                "À’B6LM60|02|320000608261",
                "À’BVZ866|02|320000608262",
                "À’BQ395S|02|320000608263",
                "À’BWA868|02|320000602081",
                "À’B596L6|02|320000608264",
                "À’B181S8|02|320000608265",
                "À’B6LR06|02|320000602099",
                "À’BV0H90|02|320000608266",
                "À’B6Y873|02|320000608267",
                "À’BQ8J57|02|320000608095",
                "À’BQ198G|02|320000608268",
                "À’B178RW|02|320000608269",
                "À’BQ2R36|02|320000608270",
                "À’BBQ770|02|320000608271",
                "À’B2BT19|02|320000602098",
                "À’BX678|16|320000602122",
                "À’BW1726|02|320000602123",
                "À’BW8588|02|320000602125",
                "À’B69759|02|320000602124",
                "À’B8MN13|02|320000608097",
                "À’B8MM83|02|320000608096",
                "À’BS108N|02|320000608272",
                "À’B3LP82|02|320000602082",
                "À’B8MM69|02|320000602085",
                "À’B032XH|02|320000608098",
                "À’B6MG91|02|320000602084",
                "À’BM2669|02|320000608099",
                "À’B5Y201|02|320000608274",
                "À’BL667Y|02|320000608273",
                "À’BM3651|02|320000608060",
                "À’HSW591|02|320000608275",
                "À’BG9881|02|320000608276",
                "À’B267KC|02|320000608277",
                "À’BBA651|02|320000608061",
                "À’B366JR|02|320000608062",
                "À’BB5082|02|320000608278",
                "À’BV3N85|02|320000608279",
                "À’B081C5|02|320000608063",
                "À’B533RV|02|320000608349",
                "À’B781Q8|02|320000608348",
                "À’B029F5|02|320000608347",
                "À’BMM730|02|320000608346",
                "À’B228YX|02|320000608345",
                "À’BWA088|02|320000608344",
                "À’BAP880|02|320000608343",
                "À’B887JU|02|320000608064",
                "À’BV8S58|02|320000608342",
                "À’B832VG|02|320000608341",
                "À’BV7J88|02|320000608340",
                "À’B662VP|02|320000608359",
                "À’BN915E|02|320000608065",
                "À’B219LU|02|320000608358",
                "À’B308LH|02|320000608357",
                "À’B226V8|02|320000608356",
                "À’B818JG|02|320000608355",
                "À’B995S3|02|320000608354",
                "À’B250VS|02|320000608066",
                "À’B989VN|02|320000608353",
                "À’B336S7|02|320000608352",
                "À’B9MF78|02|320000602126",
                "À’B3NS69|02|320000602127",
                "À’BT1H15|02|320000602083",
                "À’B713LJ|02|320000608350",
                "À’B1MS90|02|320000608067",
                "À’BLF111|02|320000608068",
                "À’BQ002A|02|320000608020",
                "À’B0NX79|02|320000602074",
                "À’BRD185|02|320000608021",
                "À’B319QM|02|320000608069",
                "À’B3NX26|02|320000602128",
                "À’B88172|02|320000602129",
                "À’B82767|02|320000602131",
                "À’B92886|02|320000602130",
                "À’BW8116|02|320000602132",
                "À’B7NG06|02|320000602133",
                "À’B81102|02|320000602134",
                "À’B8MA91|02|320000602135",
                "À’BW8182|02|320000602136",
                "À’B1MK80|02|320000603475",
                "À’B6M233|02|320000603537",
                "À’BA9372|02|320000608194",
                "À’B81679|02|320000608180",
                "À’B81672|02|320000608190",
                "À’BA9763|02|320000608195",
                "À’BA7523|02|320000608196",
                "À’BG6176|02|320000608198",
                "À’BA9922|02|320000608197",
                "À’B81699|02|320000608192",
                "À’BA9916|02|320000608193",
                "À’B81682|02|320000608191",
                "À’BG6167|02|320000608199",
                "À’BG6121|02|320000608189",
                "À’BG6199|02|320000608188",
                "À’B8J823|02|320000608308",
                "À’BG6182|02|320000608186",
                "À’BG6209|02|320000608187",
                "À’BG6210|02|320000608185",
                "À’BG6208|02|320000608184",
                "À’BG6202|02|320000608183",
                "À’BG6192|02|320000608182",
                "À’BG6206|02|320000608181",
                "À’BG6190|02|320000608164",
                "À’BBE252|02|320000608307",
                "À’BG6201|02|320000608160",
                "À’BG6198|02|320000608161",
                "À’B81563|02|320000608166",
                "À’B81670|02|320000608167",
                "À’BB5813|02|320000608162",
                "À’BB5928|02|320000608168",
                "À’BB5811|02|320000608163",
                "À’BB6722|02|320000608169",
                "À’BB6730|02|320000608165",
                "À’B727A3|02|320000608306",
                "À’B631Q0|02|320000608305",
                "À’BKL302|02|320000608304",
                "À’B5LR38|02|320000608022",
                "À’B5LN53|02|320000608025",
                "À’B756A0|02|320000608303",
                "À’B271S3|02|320000608302",
                "À’B972WJ|02|320000608026",
                "À’B97739|02|320000608023",
                "À’B163S5|02|320000608070",
                "À’BM0753|02|320000602346",
                "À’B6Y882|02|320000608071",
                "À’BKJ290|02|320000608301",
                "À’BY0A20|02|320000608319",
                "À’BWA323|02|320000608300",
                "À’BG2026|02|320000608073",
                "À’BA8806|02|320000608024",
                "À’BMZ357|02|320000608318",
                "À’B65M65|02|320000608317",
                "À’B970VF|02|320000608316",
                "À’B835VK|02|320000608315",
                "À’BYS222|02|320000608314",
                "À’B819P9|02|320000608313",
                "À’BB1798|02|320000608075",
                "À’B207W7|02|320000608312",
                "À’B897YW|02|320000608311",
                "À’BM0728|02|320000602138",
                "À’B91535|02|320000602139",
                "À’BG6650|02|320000602137",
                "À’Bg6651|02|320000602140",
                "À’B63708|02|320000603499",
                "À’Bm0280|02|320000603476",
                "À’B73358|02|320000602142",
                "À’B68268|02|320000602143",
                "À’Bw8151|02|320000602141",
                "À’BW8163|02|320000602148",
                "À’B2NP82|02|320000602144",
                "À’B98260|02|320000602145",
                "À’B3J216|02|320000602146",
                "À’BY681R|02|320000602147",
                "À’B118VS|02|320000608310",
                "À’B2NR38|02|320000608074",
                "À’BN309S|02|320000608249",
                "À’BR120H|02|320000608247",
                "À’B553S5|02|320000608246",
                "À’BY1B50|02|320000608248",
                "À’BQ901U|02|320000608077",
                "À’B76016|01|320000608245",
                "À’BR0L65|02|320000608244",
                "À’BB277F|02|320000608243",
                "À’BGZ926|02|320000608076",
                "À’BM0282|01|320000608242",
                "À’B9LT90|02|320000608078",
                "À’B5MP85|02|320000608028",
                "À’B9MC99|02|320000608027",
                "À’B25P27|02|320000608030",
                "À’B881S3|02|320000608241",
                "À’BNC003|02|320000608240",
                "À’B5NQ30|02|320000608029",
                "À’BM0301|01|320000608259",
                "À’B72036|02|320000608031",
                "À’B7Y078|02|320000608258",
                "À’B619MY|02|320000608257",
                "À’BB739U|02|320000608256",
                "À’JGE306|02|320000608255",
                "À’BY8E63|02|320000608253",
                "À’B86211|01|320000608252",
                "À’B307LF|02|320000608254",
                "À’BQ8110|02|320000608251",
                "À’B91767|02|320000608079",
                "À’B5JS23|02|320000608032",
                "À’B805JK|02|320000608033",
                "À’B550VA|02|320000608100",
                "À’E85H2T|02|320000608250",
                "À’B6202S|02|320000608101",
                "À’BH7Q23|02|320000608149",
                "À’B5Y915|02|320000608148",
                "À’BN6699|02|320000608147",
                "À’B326VR|02|320000608146",
                "À’B881N0|02|320000608035",
                "À’BBM128|02|320000602152",
                "À’B65710|02|320000602154",
                "À’B66357|02|320000602151",
                "À’B768J2|02|320000602153",
                "À’BR6J67|02|320000602155",
                "À’BM1773|02|320000602150",
                "À’BW8211|02|320000602156",
                "À’BW7789|02|320000602149",
                "À’B91663|02|320000600353",
                "À’BB0335|02|320000600352",
                "À’BW6578|02|320000600351",
                "À’BB5331|02|320000600749",
                "À’BW5225|02|320000600748",
                "À’BB0217|02|320000600747",
                "À’BW6511|02|320000600746",
                "À’BB5330|02|320000600745",
                "À’BB5335|02|320000600744",
                "À’BB5333|02|320000600743",
                "À’BB0219|02|320000600742",
                "À’BW9810|02|320000600741",
                "À’BW9870|02|320000600740",
                "À’B87987|02|320000600753",
                "À’B78858|02|320000603478",
                "À’B82216|02|320000603479",
                "À’BW083R|02|320000602159",
                "À’B8R060|02|320000602158",
                "À’BW7755|02|320000602157",
                "À’BF7E96|02|320000600754",
                "À’B67858|02|320000604119",
                "À’B67830|02|320000604110",
                "À’B67855|02|320000604118",
                "À’B67823|02|320000604109",
                "À’B75139|02|320000604117",
                "À’B67828|02|320000604108",
                "À’B67822|02|320000604107",
                "À’B75950|02|320000604116",
                "À’B75963|02|320000604114",
                "À’B67811|02|320000604104",
                "À’B67812|02|320000604105",
                "À’B75962|02|320000604115",
                "À’B67810|02|320000604103",
                "À’B67805|02|320000604102",
                "À’B67803|02|320000604101",
                "À’B67818|02|320000604106",
                "À’B67802|02|320000604100",
                "À’B66693|02|320000604113",
                "À’B66682|02|320000604112",
                "À’B67530|02|320000604111",
                "À’B72921|02|320000608171",
                "À’B72731|02|320000608173",
                "À’B87630|02|320000608174",
                "À’B87691|02|320000608172",
                "À’B66680|02|320000608170",
                "À’B9MK01|02|320000608034",
                "À’B75063|01|320000608175",
                "À’B93121|02|320000605864",
                "À’B709U0|02|320000608145",
                "À’B369S9|02|320000608144",
                "À’B2JS98|02|320000608143",
                "À’B926S9|02|320000608142",
                "À’B083VJ|02|320000608141",
                "À’BKL192|02|320000608140",
                "À’B860KC|02|320000608036",
                "À’B056VG|02|320000608159",
                "À’BWH613|02|320000608158",
                "À’BB6671|02|320000608179",
                "À’BB6727|02|320000608177",
                "À’BB5822|02|320000608176",
                "À’BB5933|02|320000608178",
                "À’BB5812|02|320000608041",
                "À’BG6191|02|320000608044",
                "À’BG5912|02|320000608043",
                "À’BG6216|02|320000608042",
                "À’B81697|02|320000608040",
                "À’B20N11|02|320000608157",
                "À’B3KT35|02|320000608045",
                "À’BKM215|02|320000608156",
                "À’B751S8|02|320000608155",
                "À’BA9199|02|320000608046",
                "À’B1269G|02|320000608050",
                "À’BRF052|02|320000608047",
                "À’BRG962|02|320000608153",
                "À’B7B916|02|320000608154",
                "À’BN739E|02|320000608152",
                "À’BV879T|02|320000608151",
                "À’BV932B|02|320000608150",
                "À’BN689R|02|320000608129",
                "À’BB390D|02|320000608126",
                "À’B96892|02|320000600755",
                "À’BM5323|02|320000600756",
                "À’B95105|02|320000600757",
                "À’BX988|16|320000600758",
                "À’BW118|16|320000600759",
                "À’B88507|02|320000604029",
                "À’BV0F51|02|320000604028",
                "À’BM3011|02|320000604026",
                "À’B9MN56|02|320000604027",
                "À’B5JP93|02|320000604025",
                "À’B3NZ96|02|320000604024",
                "À’B9NY96|02|320000604023",
                "À’B9NY22|02|320000604022",
                "À’BH6319|02|320000604020",
                "À’B1MV21|02|320000604021",
                "À’B1N259|02|320000604039",
                "À’B7JB28|02|320000608039",
                "À’B0MB01|02|320000608037",
                "À’B9NN31|02|320000608038",
                "À’BMV910|02|320000608127",
                "À’B886JN|02|320000608124",
                "À’BJX533|02|320000608125",
                "À’B870WX|02|320000608123",
                "À’B227VK|02|320000608122",
                "À’BW1698|02|320000608048",
                "À’B853S8|02|320000608121",
                "À’B023YR|02|320000608120",
                "À’B879QX|02|320000608139",
                "À’BW286L|02|320000608138",
                "À’B275YV|02|320000608137",
                "À’B81690|02|320000602392",
                "À’B81681|02|320000608051",
                "À’B392YR|02|320000608136",
                "À’B890S9|02|320000608135",
                "À’BF781D|02|320000608134",
                "À’B393B1|02|320000608133",
                "À’B81M87|02|320000608132",
                "À’BGZ337|02|320000608131",
                "À’B888F1|02|320000608130",
                "À’BY5K65|02|320000604169",
                "À’B599S9|02|320000608052",
                "À’B850LQ|02|320000604168",
                "À’B028S9|02|320000604167",
                "À’BR1B10|02|320000608053",
                "À’B096VJ|02|320000604166",
                "À’B60230|02|320000604038",
                "À’BM5353|02|320000604036",
                "À’BW5905|02|320000604037",
                "À’BV983C|02|320000604035",
                "À’BM8175|02|320000604034",
                "À’BM3029|02|320000604033",
                "À’B68599|02|320000604032",
                "À’BJV331|02|320000604031",
                "À’BW8517|02|320000604030",
                "À’BR3B17|02|320000604009",
                "À’BA6595|02|320000604008",
                "À’BB0398|02|320000604007",
                "À’B7MN69|02|320000604006",
                "À’BM1875|02|320000604005",
                "À’BM0123|02|320000604004",
                "À’BM7731|02|320000604003",
                "À’BW6800|02|320000604002",
                "À’B2MS68|02|320000604001",
                "À’BM6657|02|320000604000",
                "À’B713LJ|02|320000608350",
                "À’B5Y907|02|320000608351",
                "À’B700U7|02|320000608320",
                "À’BM251Y|02|320000608321",
                "À’B855D0|02|320000608322",
                "À’BW2X89|02|320000608323",
                "À’B536Q6|02|320000608324",
                "À’B715BP|02|320000608325",
                "À’B1EM82|02|320000608326",
                "À’BQ312V|02|320000608327",
                "À’B799VF|02|320000608328",
                "À’BKF561|02|320000608329",
                "À’B7Y953|02|320000608330",
                "À’AJD953|02|320000608331",
                "À’B7W881|02|320000608332",
                "À’BRL601|02|320000608333",
                "À’B7K066|02|320000608334",
                "À’BN687V|02|320000608335",
                "À’B958GS|02|320000608336",
                "À’BW8996|01|320000608337",
                "À’B928JP|02|320000608338",
                "À’BNB368|02|320000608339",
                "À’BQ968N|02|320000608309",
                "À’B9MF78|02|320000602126",
                "À’B3NS69|02|320000602127",
                "À’BT1H15|02|320000602083",
                "À’BQ002A|02|320000608020",
                "À’B0NX79|02|320000602074",
                "À’BRD185|02|320000608021",
                "À’B1MS90|02|320000608067",
                "À’BLF111|02|320000608068",
                "À’B319QM|02|320000608069",
        };
        for (String data : dataList) {
            String[] dataPair = data.split("|");
            try {
                Vehicle vehicle = vehicleService.synchronize(null, FuncUtil.getFzjg(dataPair[0]), dataPair[0].substring(1), dataPair[1],null);
                if (vehicle == null) {
                    LOG.error("Œ¥’“µΩ≥µ¡æ–≈œ¢");
                    continue;
                }
                if (eriService.checkCardStatus(dataPair[2], vehicle, 1)) {
                    CustomizeTask customizeTask = customizeTaskService.fetch(null, FuncUtil.getFzjg(dataPair[0]),
                            dataPair[1], dataPair[0].substring(1), 1, dataPair[2]);
                    SysUser sysUser = sysuserManager.getSysuser("zhangxd");
                    UserState.setUser(sysUser);
                    EriCustomizeContent content = eriService.customize(dataPair[2], customizeTask.getXh(), cert);
                    eriService.saveCustomizeResult(customizeTask.getXh(), 1, "", dataPair[2]);
                } else {
                    LOG.error("ø®◊¥Ã¨–£—È ß∞‹");
                }
            } catch (Exception e) {
                LOG.error("¥¶¿Ì£®" + data + "£© ß∞‹", e);
            }
        }
    }

}
